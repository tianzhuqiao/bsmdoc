<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="bsmdoc 0.0.9">
<link rel="stylesheet" href="css/bsmdoc.css" type="text/css">
<link rel="stylesheet" href="css/menu.css" type="text/css">
<script>
MathJax = {
loader: {
load: ['[tex]/tagformat']
},
tex: {
packages: {'[+]': ['tagformat']},
inlineMath: [['\\(', '\\)']],
tags: "all",
tagformat: {
id: (id) => 'mjx-eqn-' + id.replace(/\s/g, '_'),
}
}
};
</script>
<script src=" https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js "></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script type="text/javascript" language="javascript" src="js/bsmdoc.js"></script>
<script type="text/javascript" language="javascript" src="js/menu.js"></script>
<title>bsmdoc -- another technical html doc generator</title>
</head>
<body class="nomathjax">
<div class="layout">
<div class="menu">
<ul>
<li><a href="#sec-1">1 What is bsmdoc?</a><ul>
<li><a href="#sec-1-1">1.1 Installation</a></li>
<li><a href="#sec-1-2">1.2 Get Started</a></li>
<li><a href="#sec-1-3">1.3 1-minute Tutorial</a></li>
</ul></li>
<li><a href="#sec-heading">2 Heading</a></li>
<li><a href="#sec-3">3 List</a></li>
<li><a href="#sec-link">4 Link</a><ul>
<li><a href="#sec-4-1">4.1 Footnote</a></li>
<li><a href="#sec-4-2">4.2 Reference & Citation</a></li>
</ul></li>
<li><a href="#sec-image">5 Image & Video</a><ul>
<li><a href="#sec-image-image">5.1 Image</a></li>
<li><a href="#sec-5-2">5.2 Video</a></li>
</ul></li>
<li><a href="#sec-equation">6 Equation</a></li>
<li><a href="#sec-table">7 Table</a></li>
<li><a href="#sec-highlight">8 Syntax Highlighting</a></li>
<li><a href="#sec-9">9 Raw Text Block</a></li>
<li><a href="#sec-funblock">10 Function Block</a><ul>
<li><a href="#sec-10-1">10.1 Generate Images</a></li>
<li><a href="#sec-10-2">10.2 Include Source Code</a></li>
<li><a href="#sec-10-3">10.3 Inline Function Block</a></li>
<li><a href="#sec-10-4">10.4 Express Function Block</a></li>
</ul></li>
<li><a href="#sec-11">11 Input Redirection</a></li>
<li><a href="#sec-template">12 HTML Template</a></li>
</ul>
</div>
<div class="main">
<div class="toptitle">
bsmdoc -- another technical html doc generator (ver 0.0.9) <a href="https://github.com/tianzhuqiao/bsmdoc"><img src="image/github.svg" alt="image/github.svg" width="32" height="32"></a>
</div>
<div class="content">
<h1 id="sec-1">1 What is bsmdoc?</h1>
<p>bsmdoc is a tool to generate technical static html docs:</p>
<ul>
<li><b>Light-weighted</b>;</li>
<li><b>Highly extendable</b>;</li>
<li><b>Single file doc</b>: generate everything in a single file.</li>
</ul>
<p>bsmdoc splits the whole doc into blocks (e.g., equation block, paragraph block, heading block, ...). In the following sections, we will show each block in detail, as well as the way to extend the existing blocks.</p>
<h2 id="sec-1-1">1.1 Installation</h2>
<p>bsmdoc can be installed with pip</p>
<div class="syntax"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>bsmdoc
</pre></div>
<p>You can also clone the <a href="https://github.com/tianzhuqiao/bsmdoc">repository</a> and run setup.py</p>
<div class="syntax"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
<h2 id="sec-1-2">1.2 Get Started</h2>
<ol>
<li><p>Create a file (e.g., <strong>helloworld.bsmdoc</strong>) with content</p>
<div class="syntax"><pre><span></span><span class="nt">=</span><span class="gh"> hello world</span>
</pre></div></li>
<li><p>Compile the file</p>
<div class="syntax"><pre><span></span><span class="gp">$ </span>bsmdoc<span class="w"> </span>helloworld.bsmdoc
</pre></div></li>
<li><p>It will generate <strong>helloworld.html</strong> in the same folder, which may look like</p>
<div class="syntax"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;generator&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;bsmdoc 0.0.9&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;css/bsmdoc.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nomathjax&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;layout&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>hello world<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;footer&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;footer-text&quot;</span><span class="p">&gt;</span> Last updated 2023-12-27 22:06:03 UTC by
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;http://bsmdoc.feiyilin.com/&quot;</span><span class="p">&gt;</span>bsmdoc<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div></li>
</ol>
<h2 id="sec-1-3">1.3 1-minute Tutorial</h2>
<p>bsmdoc also provides some commands to create project and .bsmdoc.</p>
<ol>
<li><p>First, create a project</p>
<div class="syntax"><pre><span></span><span class="gp">$ </span>mkdir<span class="w"> </span>myprj
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>myprj
<span class="gp">$ </span>bsmdoc<span class="w"> </span>init
</pre></div>
<p>The last command will</p>
<ol>
<ol>
<li>copy the default css and javascript files to the current folder;</li>
<li>create <b>index.bsmdoc</b> from template;</li>
<li>generate <b>index.html</b> from <b>index.bsmdoc</b>.</li>
</ol>
</ol></li>
<li><p>Now, you can update the <b>index.bsmdoc</b> and then regenerate the html</p>
<div class="syntax"><pre><span></span><span class="gp">$ </span>bsmdoc<span class="w"> </span>index.bsmdoc
</pre></div></li>
<li><p>Add a new doc from template to current folder</p>
<div class="syntax"><pre><span></span><span class="gp">$ </span>bsmdoc<span class="w"> </span>new<span class="w"> </span>page
</pre></div>
<p>It will create the <b>page.bsmdoc</b> from template.</p></li>
</ol>
<h1 id="sec-heading">2 Heading</h1>
<p><b>heading</b> block is defined by a line starting with <code>=</code></p>
<div class="bs-example">
<h1>level 1</h1>
<h2>level 2</h2>
<h3>level 3</h3>
<h4>level 4</h4>
<h5>level 5</h5>
<h6>level 6</h6>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">=</span><span class="gh"> level 1</span>
<span class="gh">== level 2</span>
<span class="gh">=== level 3</span>
<span class="gh">==== level 4</span>
<span class="gh">===== level 5</span>
<span class="gh">====== level 6</span>
</pre></div>
</div>
<p>As you have seen, heading block must start at a new line. Otherwise, <code>=</code> (e.g., in a paragraph) is just normal equal sign.
bsmdoc supports all 6 heading levels as shown above. However, we don't think anyone needs all these 6 levels (remember, <a href="http://www.feynmanlectures.caltech.edu/">"The Feynman Lectures on Physics"</a> only uses 2 levels).</p>
<p>heading text can spread over multiple lines as long as they are enclosed by "<code>{}</code>", as shown in the following example. Actually, "<code>{}</code>" also define a basic block in bsmdoc. It is quite flexible to define the heading text; generally, you are allowed to put everything in it.</p>
<div class="bs-example">
<h1>multiple<br>
line<br>
heading</h1>
<h1>multiple
line
heading</h1>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">=</span><span class="gh"> {multiple\n</span>
<span class="gh">line\n</span>
<span class="gh">heading}</span>
<span class="nt">=</span><span class="gh"> {multiple</span>
<span class="gh">line</span>
<span class="gh">heading}</span>
</pre></div>
</div>
<p>To add reference to the <b>heading</b> block, first you need to add a label with command "<code>\label</code>". Then, it can be referenced as a normal in-page <a href="#sec-link">link</a>.</p>
<div class="bs-example">
<h1 id="sec-label">section with label</h1>
<p>This <a href="#sec-label">section</a> ...</p>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">=</span><span class="gh"> {section with label \label{sec-label}</span>}
This <span class="nt">[#sec-label</span>|<span class="s">section</span><span class="nt">]</span> ...
</pre></div>
</div>
<p>By default, the heading block will not be automatically numbered. The following configuration is used to turn on the automatic numbering</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{heading_numbering</span>|<span class="k">True</span><span class="nt">}</span>
</pre></div>
<p>bsmdoc will not start the automatic heading numbering until you set the above flag. Thus if you want bsmdoc to add numbering to the whole doc, simply put the above configuration line at the beginning of the doc. You also can set the start heading level for automatic numbering. For example, the following line will tell bsmdoc to start heading numbering from level 2 (i.e., <code>H2</code>)</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{heading_numbering_start</span>|2<span class="nt">}</span>
</pre></div>
<p>When referencing to a <b>heading</b> block with automatic heading numbering on, the link text will be automatically filled with its index if it is empty,</p>
<div class="bs-example">
Sec. <a href="#sec-heading">2</a> ...
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>Sec. <span class="nt">[#sec-heading]</span> ...
</pre></div>
</div>
<p>It can also be achieved by <code>\ref</code> command</p>
<div class="bs-example">
Sec. <a href="#sec-heading">2</a>...
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>Sec. <span class="nf">\ref</span><span class="nt">{</span>sec-heading<span class="nt">}</span>...
</pre></div>
</div>
<p>bsmdoc will generate the table of contents from the
headings, if the following configuration is enabled</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{show_table_of_contents</span>|<span class="k">True</span><span class="nt">}</span>
</pre></div>
<p>Only the headings with automatic numbering will be included in the content list.
The table of contents is generated by a function block <b>makecontent</b>.
Its input is a list that contains all the headings. The default implementation generates an un-ordered list</p>
<div class="syntax"><pre><span></span><span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;makecontent&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_makecontent</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    table of contents is a list, each item</span>
<span class="sd">    [level, text, label]</span>
<span class="sd">        level: 1~6</span>
<span class="sd">        text: the caption text</span>
<span class="sd">        label: the anchor destination</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">contents</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="n">first_level</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">])</span>
    <span class="n">call</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
        <span class="c1"># the text has been parsed, so ignore the parsing here</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">BFunction</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;href=&quot;#</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">call</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">first_level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">txt</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">BFunction</span><span class="p">()</span><span class="o">.</span><span class="n">listbullet</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</pre></div>
<h1 id="sec-3">3 List</h1>
<p>bsmdoc defines two kinds of list blocks: <b>unordered list</b> and <b>ordered list</b>.
A line leading with "<code>-</code>" will be rendered as unordered list. "<code>-</code>" will be ignored if it is not at the start of a line. Such rule holds for all <b>heading</b>, <b>unordered list</b>, and <b>ordered list</b> blocks.</p>
<div class="bs-example">
<ul>
<li>start each line</li>
<li>with an hyphen -.
<ul>
<li>more asterisks gives deeper
<ul>
<li>and deeper levels.</li>
</ul></li>
</ul></li>
<li>line breaks<br> don't break levels.
<ul>
<ul>
<li>but jumping levels creates empty space.</li>
</ul>
</ul></li>
</ul>
any other start ends the list.
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">- start each line</span>
<span class="nt">- with an hyphen -.</span>
<span class="nt">-- more asterisks gives deeper</span>
<span class="nt">--- and deeper levels.</span>
<span class="nt">- line breaks\n don&#39;t break levels.</span>
<span class="nt">--- but jumping levels creates empty space.</span>
any other start ends the list.
</pre></div>
</div>
<p>Ordered list starts with "<code>*</code>"</p>
<div class="bs-example">
<ol>
<li>start each line</li>
<li>with a start '*'
<ol>
<li>more asterisks gives deeper
<ol>
<li>and deeper levels.</li>
</ol></li>
</ol></li>
<li>line breaks<br> don't break levels.
<ol>
<ol>
<li>but jumping levels creates empty space.</li>
</ol>
</ol></li>
</ol>
any other start ends the list.
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">* start each line</span>
<span class="nt">* with a start &#39;*&#39;</span>
<span class="nt">** more asterisks gives deeper</span>
<span class="nt">*** and deeper levels.</span>
<span class="nt">* line breaks\n don&#39;t break levels.</span>
<span class="nt">*** but jumping levels creates empty space.</span>
any other start ends the list.
</pre></div>
</div>
<p><b>unordered</b> and <b>ordered</b> lists can also be arbitrarily combined</p>
<div class="bs-example">
<ul>
<li>unordered level 1
<ol>
<li>ordered item 1</li>
<li>ordered item 2</li>
</ol>
<ul>
<li>unordered item 3</li>
<li>unordered item 4</li>
</ul></li>
</ul>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">- unordered level 1</span>
<span class="nt">-* ordered item 1</span>
<span class="nt">-* ordered item 2</span>
<span class="nt">-- unordered item 3</span>
<span class="nt">-- unordered item 4</span>
</pre></div>
</div>
<p>Each item of a list can spread over multiple lines as long as they are enclosed by "<code>{}</code>":</p>
<div class="bs-example">
<ul>
<li>unordered level 1<br>
more text here
<a href="bsmdoc.feiyilin.com ">bsmdoc</a>
<ol>
<li>ordered item2</li>
</ol></li>
</ul>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">- {unordered level 1\n</span>
<span class="nt"> more text here</span>
<span class="nt">[bsmdoc.feiyilin.com | bsmdoc]</span>
<span class="nt">}</span>
<span class="nt">-* ordered item2</span>
</pre></div>
</div>
<h1 id="sec-link">4 Link</h1>
<p>Text between <code>[</code> and <code>]</code> will be rendered as link block</p>
<div class="bs-example">
<a href="http://bsmedit.feiyilin.com">http://bsmedit.feiyilin.com</a>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">[http://bsmedit.feiyilin.com]</span>
</pre></div>
</div>
<p>Link text can be customized with "<code>|</code>"</p>
<div class="bs-example">
<a href="http://bsmdoc.feiyilin.com ">bsmdoc</a>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">[http://bsmdoc.feiyilin.com </span>|<span class="s"> bsmdoc</span><span class="nt">]</span>
</pre></div>
</div>
<p>Or email</p>
<div class="bs-example">
<a href="mailto:tq@feiyilin.com ">Email</a>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">[mailto:tq@feiyilin.com </span>|<span class="s"> Email</span><span class="nt">]</span>
</pre></div>
</div>
<p>You can also easily define in-page links with <code>\anchor</code> command</p>
<div class="bs-example">
In page link <a id="myanchor"><sup>&#x2693;</sup></a>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>In page link <span class="nf">\anchor</span><span class="nt">{</span>myanchor<span class="nt">}</span>
</pre></div>
</div>
<p>Then, you can link to the in-page link by</p>
<div class="bs-example">
My in-page <a href="#myanchor">link</a>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>My in-page <span class="nt">[#myanchor</span>|<span class="s">link</span><span class="nt">]</span>
</pre></div>
</div>
<h2 id="sec-4-1">4.1 Footnote</h2>
<p>One special in-page link is <code>footnote</code><a id="footnote"><sup>&#x2693;</sup></a>. It will automatically add the link to the position it gets defined, and add the footnote content at the end of the page. bsmdoc also adds a shortcut at the end of the footnote content, so you can return to the footnote definition position easily.</p>
<div class="bs-example">
footnote example<a id="footnote_src-1" href="#footnote-1"><sup>1</sup></a>.
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>footnote example<span class="nf">\footnote</span><span class="nt">{</span>This is a footnote<span class="nt">}</span>.
</pre></div>
</div>
<p>bsmdoc will automatically add indexing to each footnote. When you move the cursor to the footnote link, the footnote content will be shown in a popup window. So you may not need to go to the end of the page to see the footnote content. The <a href="#sec-image">image</a>, <a href="#sec-equation">equation</a> and <a href="#sec-table">table</a> blocks support similar feature.</p>
<h2 id="sec-4-2">4.2 Reference & Citation</h2>
<p>bsmdoc has an easy way to add references and citations. For example, the following command will add a book reference</p>
<div class="syntax"><pre><span></span><span class="nf">\reference</span><span class="nt">{Simon</span>|Simon Haykin, &quot;Adaptive Filter Theory,&quot; Prentice Hall, 4th edition, Sep. 2001<span class="nt">}</span>
</pre></div>
<p><strong>Simon</strong> before "<code>|</code>" is the alias, which can be used to cite it, e.g.,</p>
<div class="bs-example">
The LMS algorithm in [<a id="cite-1-1" href="#reference-1">1</a>]...
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>The LMS algorithm in <span class="nf">\cite</span><span class="nt">{</span>Simon<span class="nt">}</span>...
</pre></div>
</div>
<p>And the reference is not required to be defined before citation. If bsmdoc can not find the reference when it sees <code>\cite</code>, it will trigger the second scan, in case the reference is defined after the citation. If the reference is still missing at the second scan, bsmdoc will show a warning.</p>
<p>All cited references will be appended to the end of the document in the citation order. If you want to add the reference without citation, you can use the <code>hide</code> argument of the <code>cite</code> command</p>
<div class="syntax"><pre><span></span><span class="nf">\cite</span><span class="nt">{hide</span>|Simon<span class="nt">}</span>...
</pre></div>
<p>In this case, it will not generate the link to the reference, but the reference will still be added to the reference list even if there is no explicit citation in the document.</p>
<h1 id="sec-image">5 Image & Video</h1>
<h2 id="sec-image-image">5.1 Image</h2>
<p>The syntax of the <b>image</b> block is</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">image</span>||
image_file_path
<span class="nt">!}</span>
</pre></div>
<p>So, to include an image</p>
<div class="bs-example">
<figure class="figure">
<img src="./image/scatter.svg" alt="./image/scatter.svg">
</figure>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">image</span>||
./image/scatter.svg
<span class="nt">!}</span>
</pre></div>
</div>
<p>You can add optional caption to an image block</p>
<div class="bs-example">
<figure class="figure">
<img src="./image/scatter.svg" alt="./image/scatter.svg">
<figcaption class="caption"><span class="tag">Fig.2.</span> Example scatter image</figcaption>
</figure>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">image</span>||
<span class="nf">\caption</span><span class="nt">{</span>Example scatter image<span class="nt">}</span>
./image/scatter.svg
<span class="nt">!}</span>
</pre></div>
</div>
<p>To add reference to an image, you need to</p>
<ol>
<li><p>add a label to an image block with <code>\label</code> command</p>
<div class="bs-example">
<figure id="img-scatter" class="figure">
<img src="./image/scatter.svg" alt="./image/scatter.svg">
<figcaption class="caption"><span class="tag">Fig.3.</span> Example scatter image</figcaption>
</figure>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">image</span>||
<span class="nf">\label</span><span class="nt">{</span>img-scatter<span class="nt">}</span>
<span class="nf">\caption</span><span class="nt">{</span>Example scatter image<span class="nt">}</span>
./image/scatter.svg
<span class="nt">!}</span>
</pre></div>
</div></li>
<li><p>add reference to the image with <code>\ref</code> command</p>
<div class="bs-example">
Fig. <a href="#img-scatter">3</a> shows a scatter diagram
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>Fig. <span class="nf">\ref</span><span class="nt">{</span>img-scatter<span class="nt">}</span> shows a scatter diagram
</pre></div>
</div></li>
</ol>
<p>Here the reference link <code>\ref{img-scatter}</code>) is defined after the definition of the image block. The reference link text is automatically replaced with the image index. In some case, if the reference link is created before the image block is defined, bsmdoc will not know the destination when it sees the reference link. In this case, the second scan will automatically be triggered to solve the reference link.</p>
<p>When the cursor is moved to the reference link, the referenced image will be highlighted if it is visible; otherwise, the image will be shown in a popup window. Such feature is inspired by <a href="http://www.feynmanlectures.caltech.edu/">"The Feynman Lectures on Physics"</a> website. It allows you to view the images at the current reference position. Otherwise, you would have to follow the link to the original place where the image is first included. To use such feature, the image label should start with "<code>img-</code>", which is hard-coded in the Javascript. The references to <a href="#sec-equation">equation</a>, <a href="#sec-table">table</a>, and <a href="#footnote">footnote</a> behave similarly.</p>
<p>As you have seen, the image block can automatically add the numbering to the image with label. The default automatic indexing format is: "<code>Fig. I.</code>", where "<code>I</code>" is the current index. You can configure the automatic prefix text. For example, to change it to "<code>Image</code>", the following line can be inserted before a image block definition (usually at the beginning of the doc, so that it affects all the image blocks)</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{image_numbering_prefix</span>|Image <span class="nt">}</span>
</pre></div>
<p>For example</p>
<div class="bs-example">
<figure id="img-scatter2" class="figure">
<img src="./image/scatter.svg" alt="./image/scatter.svg">
<figcaption class="caption"><span class="tag">Image 4.</span> Example scatter image</figcaption>
</figure>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">image</span>||
<span class="nt">\config{image_numbering_prefix</span>|Image }
<span class="nf">\label</span><span class="nt">{</span>img-scatter2<span class="nt">}</span>
<span class="nf">\caption</span><span class="nt">{</span>Example scatter image<span class="nt">}</span>
./image/scatter.svg
<span class="nt">!}</span>
</pre></div>
</div>
<p>The options to configure the image numbering</p>
<table>
<thead>
<tr>
<th>Option</th><th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>image_numbering</td><td><b>True</b> or <b>False</b> (default). Turn on/off numbering, e.g., <div class="syntax-inline"><pre><span></span><span class="nf">\config</span><span class="nt">{image_numbering</span>|<span class="k">True</span><span class="nt">}</span>
</pre></div></td>
</tr>
<tr>
<td>image_numbering_prefix</td><td>The numbering prefix (default "<b>Fig.</b>"). To change the prefix, e.g., <div class="syntax-inline"><pre><span></span><span class="nf">\config</span><span class="nt">{image_numbering_prefix</span>|Image.<span class="nt">}</span>
</pre></div></td>
</tr>
<tr>
<td>image_numbering_num_prefix</td><td>The numbering prefix (default ""). To change the prefix, e.g., <div class="syntax-inline"><pre><span></span><span class="nf">\config</span><span class="nt">{image_numbering_num_prefix</span>|3.<span class="nt">}</span>
</pre></div></td>
</tr>
</tbody>
</table>
<h2 id="sec-5-2">5.2 Video</h2>
<p>Video block is almost same as the image block. Its syntax is</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">video</span>||
video_file_path
<span class="nt">!}</span>
</pre></div>
<p>For example, to add reference to an image, you need to</p>
<ol>
<li><p>add a label to an image block with <code>\label</code> command</p>
<div class="bs-example">
<div id="video-waves" class="video">
<video controls><source src="./image/waves.mp4">
Your browser does not support the video tag.</video>
<div class="caption">
<span class="tag">Image 5.</span> Example video
</div>
</div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">video</span>||
<span class="nf">\label</span><span class="nt">{</span>video-waves<span class="nt">}</span>
<span class="nf">\caption</span><span class="nt">{</span>Example video<span class="nt">}</span>
./image/waves.mp4
<span class="nt">!}</span>
</pre></div>
</div></li>
<li><p>add reference to the image with <code>\ref</code> command</p>
<div class="bs-example">
Vid. <a href="#video-waves">5</a> shows a scatter diagram
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>Vid. <span class="nf">\ref</span><span class="nt">{</span>video-waves<span class="nt">}</span> shows a scatter diagram
</pre></div>
</div></li>
</ol>
<p>The options to configure the video numbering</p>
<table>
<thead>
<tr>
<th>Option</th><th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>video_numbering</td><td><b>image</b> (default) or <b>True</b> or <b>False</b>. Turn on/off numbering. If it is set to <b>image</b>, then it will share numbering with <a href="#sec-image-image">image</a> block.</td>
</tr>
<tr>
<td>video_numbering_prefix</td><td>The numbering prefix (default "<b>Video.</b>"). Only valid if <b>video_numbering</b> is not <b>image</b>.</td>
</tr>
<tr>
<td>video_numbering_num_prefix</td><td>The numbering prefix (default ""). Only valid if <b>video_numbering</b> is not <b>image</b>.</td>
</tr>
</tbody>
</table>
<h1 id="sec-equation">6 Equation</h1>
<p>Equation is rendered with <a href="http://www.mathjax.org">mathjax</a>: both inline and normal equation blocks. The <a href="http://docs.mathjax.org/en/latest/web/configuration.html">configuration</a> may look like:</p>
<div class="syntax"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="nx">MathJax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">tex</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">inlineMath</span><span class="o">:</span><span class="w"> </span><span class="p">[[</span><span class="s1">&#39;\\(&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;\\)&#39;</span><span class="p">]],</span>
<span class="w">            </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">};</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;MathJax-script&quot;</span> <span class="na">async</span>
<span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/tex-mml-chtml.js&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
<p>Such configuration can be included in a configuration file, which will be shown in detail in Sec. <a href="#sec-template">12</a>.</p>
<p>bsmdoc looks for "<code>\(...\)</code>" (or "<code>$...$</code>") as delimiters for inline equation block</p>
<div class="bs-example">
Newton's second law is often stated as \(F=ma\), which means the force (\(F\)) acting on an object is equal to the mass (\(m\)) of an object times its acceleration (\(a\)).
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>Newton&#39;s second law is often stated as <span class="nt">\(F=ma\)</span>, which means the force (<span class="nt">\(F\)</span>) acting on an object is equal to the mass (<span class="nt">$m$</span>) of an object times its acceleration (<span class="nt">$a$</span>).
</pre></div>
</div>
<p>The normal equation block looks like</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">math</span>||<span class="nt">{%</span>
Latex Equation
<span class="nt">%}!}</span>
</pre></div>
<p>or</p>
<div class="syntax"><pre><span></span><span class="nt">$$</span>
<span class="nt">Latex Equation</span>
<span class="nt">$$</span>
</pre></div>
<p>For example</p>
<div class="bs-example">
<div class="mathjax">
$$
\begin{align}
\begin{bmatrix}
0      & \cdots & 0      \\
\vdots & \ddots & \vdots \\
0      & \cdots & 0
\label{eqn:matrix}
\end{bmatrix}
\end{align}
$$
</div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">math</span>||<span class="nt">{%</span>
<span class="k">\begin</span><span class="nb">{</span>align<span class="nb">}</span>
<span class="k">\begin</span><span class="nb">{</span>bmatrix<span class="nb">}</span>
0      <span class="nb">&amp;</span> <span class="k">\cdots</span> <span class="nb">&amp;</span> 0      <span class="k">\\</span>
<span class="k">\vdots</span> <span class="nb">&amp;</span> <span class="k">\ddots</span> <span class="nb">&amp;</span> <span class="k">\vdots</span> <span class="k">\\</span>
0      <span class="nb">&amp;</span> <span class="k">\cdots</span> <span class="nb">&amp;</span> 0
<span class="k">\label</span><span class="nb">{</span>eqn:matrix<span class="nb">}</span>
<span class="k">\end</span><span class="nb">{</span>bmatrix<span class="nb">}</span>
<span class="k">\end</span><span class="nb">{</span>align<span class="nb">}</span>
<span class="nt">%}!}</span>
</pre></div>
</div>
<p>bsmdoc generally keeps the equation content (i.e., the content between <code>{%...%}</code>) untouched, except <code>&lt;</code> and <code>&gt;</code>, which will be replaced with <code>&amp;lt;</code> and <code>&amp;gt;</code> respectively, to avoid conflicts with html tags. For example,</p>
<div class="bs-example">
<pre>$a &amp;gt; 5$</pre>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">$a&gt;5$</span>
</pre></div>
</div>
<p>Unlike the <a href="#sec-image">image</a> block mentioned above, the reference to equation is also handled by <a href="http://www.mathjax.org">mathjax</a>. The syntax is same as \(Latex\)</p>
<div class="bs-example">
Eq. (\ref{eqn:matrix}) or
Eq. (\ref{eqn:matrix})
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>Eq. (<span class="nf">\ref</span><span class="nt">{</span>eqn:matrix<span class="nt">}</span>) or
Eq. (<span class="nf">\eqref</span><span class="nt">{</span>eqn:matrix<span class="nt">}</span>)
</pre></div>
</div>
<p>As mentioned above, same as the <a href="#sec-image">image</a> block, when move the cursor to the equation reference link, bsmdoc will highlight the referenced equation if it is visible. Otherwise, a popup window will be displayed to show the equation.</p>
<h1 id="sec-table">7 Table</h1>
<p>The table block is defined with <code>{{...}}</code>, where</p>
<ul>
<li>each row is ended by "<code>|-</code>";</li>
<li>each column in a row is terminated by "<code>|</code>".</li>
</ul>
<p>The content in each column of each row can be anything defined above, for example, <a href="#sec-link">Link</a>, <a href="#sec-image">Image</a>, <a href="#sec-equation">Equation</a>,...</p>
<div class="bs-example">
<table>
<tbody>
<tr>
<td>item1</td><td>\(E=MC^2\)</td>
</tr>
<tr>
<td><a href="http://bsmdoc.feiyilin.com">bsmdoc</a></td><td><div class="figure image-left image-thumbnail">
<img src="image/scatter.svg" alt="image/scatter.svg">
</div></td>
</tr>
</tbody>
</table>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{{</span>
item1 | <span class="nt">$E=MC^2$</span> |<span class="k">|-</span>
<span class="nt">[http://bsmdoc.feiyilin.com</span>|<span class="s">bsmdoc</span><span class="nt">]</span> | <span class="nt">{!</span><span class="nf">div</span>|<span class="nt">figure</span>|<span class="nt">image-left</span>|<span class="nt">image-thumbnail</span>||<span class="nf">\image</span><span class="nt">{</span>image/scatter.svg<span class="nt">}!}</span> |<span class="k">|-</span>
<span class="nt">}}</span>
</pre></div>
</div>
<p>Optionally, a heading line can be added in the front of the table block</p>
<ul>
<li><p>the heading line is delimited by "<code>|+</code>".</p>
<div class="bs-example">
<table>
<thead>
<tr>
<th>Heading1</th><th>Heading2</th>
</tr>
</thead>
<tbody>
<tr>
<td>item1</td><td>item2</td>
</tr>
<tr>
<td>item3</td><td>item4</td>
</tr>
</tbody>
</table>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{{</span>
Heading1 | Heading2|<span class="k">|+</span>
item1 | item2 |<span class="k">|-</span>
item3 | item4 |<span class="k">|-</span>
<span class="nt">}}</span>
</pre></div>
</div></li>
</ul>
<p>Furthermore, a caption can be added to the table block too</p>
<div class="bs-example">
<table>
<caption>Example table title</caption>
 <thead>
<tr>
<th>Heading1</th><th>Heading2</th>
</tr>
</thead>
<tbody>
<tr>
<td>item1</td><td>item2</td>
</tr>
<tr>
<td>item3</td><td>item4</td>
</tr>
</tbody>
</table>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{{</span>
<span class="nf">\caption</span><span class="nt">{</span>Example table title<span class="nt">}</span>
Heading1 | Heading2|<span class="k">|+</span>
item1 | item2 |<span class="k">|-</span>
item3 | item4 |<span class="k">|-</span>
<span class="nt">}}</span>
</pre></div>
</div>
<p>bsmdoc can also add the automatic indexing to the table caption. To do that, you need to</p>
<ol>
<li><p>turn on the option</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{table_numbering</span>|<span class="k">True</span><span class="nt">}</span>
</pre></div>
<p>bsmdoc will add the automatic indexing to all the tables defined after the above line, until you explicitly turn off the configuration.</p></li>
<li><p>add the label to each table if you want to reference it</p>
<div class="syntax"><pre><span></span><span class="nf">\label</span><span class="nt">{</span>table_label<span class="nt">}</span>
</pre></div></li>
</ol>
<p>For example</p>
<div class="bs-example">
<table id="tbl-example">
<caption><span class="tag">Table.5.</span> Example table title</caption>
 <thead>
<tr>
<th>Heading1</th><th>Heading2</th>
</tr>
</thead>
<tbody>
<tr>
<td>item1</td><td>item2</td>
</tr>
<tr>
<td>item3</td><td>item4</td>
</tr>
</tbody>
</table>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{{</span>
<span class="nf">\config</span><span class="nt">{table_numbering</span>|<span class="k">True</span><span class="nt">}</span>
<span class="nf">\label</span><span class="nt">{</span>tbl-example<span class="nt">}</span>
<span class="nf">\caption</span><span class="nt">{</span>Example table title<span class="nt">}</span>
Heading1 | Heading2|<span class="k">|+</span>
item1 | item2 |<span class="k">|-</span>
item3 | item4 |<span class="k">|-</span>
<span class="nt">}}</span>
</pre></div>
</div>
<p>The default automatic indexing format is: "<code>Table. I.</code>", where "<code>I</code>" is the current index. It can also be customized. For example, to change it to "<code>TABLE</code>", the following line can be inserted before the table block definition</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{table_numbering_prefix</span>|TABLE <span class="nt">}</span>
</pre></div>
<div class="bs-example">
<table id="tbl-example2">
<caption><span class="tag">TABLE 6.</span> Example table title</caption>
 <thead>
<tr>
<th>Heading1</th><th>Heading2</th>
</tr>
</thead>
<tbody>
<tr>
<td>item1</td><td>item2</td>
</tr>
<tr>
<td>item3</td><td>item4</td>
</tr>
</tbody>
</table>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{{</span>
<span class="nf">\config</span><span class="nt">{table_numbering_prefix</span>|TABLE <span class="nt">}</span>
<span class="nf">\label</span><span class="nt">{</span>tbl-example2<span class="nt">}</span>
<span class="nf">\caption</span><span class="nt">{</span>Example table title<span class="nt">}</span>
Heading1 | Heading2|<span class="k">|+</span>
item1 | item2 |<span class="k">|-</span>
item3 | item4 |<span class="k">|-</span>
<span class="nt">}}</span>
</pre></div>
</div>
<p>The label enables not only the automatic indexing, but also the cross-reference. Reference to a table is as easy as <a href="#sec-image">image</a> and <a href="#sec-equation">equation</a> blocks</p>
<div class="bs-example">
Table <a href="#tbl-example">5</a> shows how to make a table in bsmdoc.
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>Table <span class="nf">\ref</span><span class="nt">{</span>tbl-example<span class="nt">}</span> shows how to make a table in bsmdoc.
</pre></div>
</div>
<p>If the table label text starts with "<code>tbl-</code>", when the cursor is moved to the reference index, the table will be highlighted if it is visible; otherwise, a popup window will be displayed to show the table content.</p>
<p>The options to configure the table numbering</p>
<table>
<thead>
<tr>
<th>Option</th><th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>table_numbering</td><td><b>True</b> or <b>False</b> (default). Turn on/off numbering.</td>
</tr>
<tr>
<td>table_numbering_prefix</td><td>The numbering prefix (default "<b>Table.</b>").</td>
</tr>
<tr>
<td>table_numbering_num_prefix</td><td>The numbering prefix (default "").</td>
</tr>
</tbody>
</table>
<h1 id="sec-highlight">8 Syntax Highlighting</h1>
<p>bsmdoc uses <a href="http://pygments.org/docs/quickstart/ ">Pygments</a> for syntax highlighting. The syntax is</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">highlight</span>|<span class="nt">language</span>||<span class="nt">{%</span>
code
<span class="nt">%}!}</span>
</pre></div>
<p>where <code>language</code> can be any language supported by <a href="http://pygments.org/languages/">Pygments</a>. For example,</p>
<ul>
<li><p>Python</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">highlight</span>|<span class="nt">python</span>||<span class="nt">{%</span>
print(&quot;Hello World&quot;)
<span class="nt">%}!}</span>
</pre></div>
</div></li>
<li><p>Matlab</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="nb">fprintf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Hello, world!\n&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">highlight</span>|<span class="nt">matlab</span>||<span class="nt">{%</span>
fprintf(1, &#39;Hello, world!\n&#39;);
<span class="nt">%}!}</span>
</pre></div>
</div></li>
<li><p>C++</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello World!&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">highlight</span>|<span class="nt">C++</span>||<span class="nt">{%</span>
#include &lt;iostream&gt;
using namespace std;

int main ()
{
    cout &lt;&lt; &quot;Hello World!&quot;;
    return 0;
}
<span class="nt">%}!}</span>
</pre></div>
</div></li>
</ul>
<p>The <code>highlight</code> block supports a couple of options to format the code:</p>
<ul>
<li><b>obeytabs</b>: to replace <b>tab</b> with 4 space</li>
<li><p><b>gobble=N</b>: remove the first N characters from each line.</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">highlight</span>|<span class="nt">python</span>|<span class="nt">gobble=4</span>||<span class="nt">{%</span>
    print(&quot;Hello World&quot;)
<span class="nt">%}!}</span>
</pre></div>
</div></li>
<li><b>autogobble</b>: remove leading common white space from each line.</li>
<li><p>All other keyword arguments will be forwarded to <a href="https://pygments.org/docs/formatters/">HtmlFormatter</a>. The following example turns on the line number, and highlights line 6.</p>
<div class="bs-example">
<div class="syntax"><table class="syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="hll"><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello World!&quot;</span><span class="p">;</span>
</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></td></tr></table></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">highlight</span>|<span class="nt">C++</span>|<span class="nt">linenos=table</span>|<span class="nt">hl_lines=(6,)</span>||<span class="nt">{%</span>
#include &lt;iostream&gt;
using namespace std;

int main ()
{
    cout &lt;&lt; &quot;Hello World!&quot;;
    return 0;
}
<span class="nt">%}!}</span>
</pre></div>
</div></li>
</ul>
<p>It is also possible to use other packages for syntax highlighting, which will be discussed in detail in Sec. <a href="#sec-funblock">10</a>.</p>
<h1 id="sec-9">9 Raw Text Block</h1>
<p>Sometimes you may want to skip the parsing from bsmdoc. For example, to highlight the code, it is basically not a good idea to let bsmdoc parse the code. Instead, the raw data should be sent to the code highlighting block. In another example, you may have seen similar syntax between the latex macro and the bsmdoc commands (e.g., both are preceded by "<code>\</code>"). If bsmdoc tries to parse these latex macros, the result is obviously not what you want. Thus, bsmdoc defines the raw text block. It basically tells bsmdoc to ignore all the rules on its content.
The syntax of the raw text block is</p>
<div class="syntax"><pre><span></span><span class="nt">{%</span>
Content
<span class="nt">%}</span>
</pre></div>
<p>In this case, bsmdoc will stop parsing the <code>Content</code> between <code>{%...%}</code>, and the raw text will be either sent to the final html file or send to the other function blocks to process.</p>
<p>However, sometimes you may still want to slightly process the <code>Content</code> before sending to the html file. For example, the <code>Content</code> may contain symbols (e.g., <code>&lt; &gt;</code>), which may cause conflict to the html tags. You can use the <b>escape</b> function block to process the data</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">escape</span>||<span class="nt">{%</span>
Content
<span class="nt">%}!}</span>
</pre></div>
<p>In this case, <code>&lt;</code> and <code>&gt;</code> will be replaced with <code>&amp;lt;</code> and <code>&amp;gt;</code>, respectively.</p>
<div class="info">
The <a href="#sec-equation">equation</a> block will automatically replace <code>&lt;</code> (<code>&gt;</code>) with <code>&amp;lt;</code> (<code>&amp;gt;</code>). Thus, there is no need to explicitly call the <b>escape</b> function block.
</div>
<p>By symmetry, bsmdoc also defines the <b>unescape</b> function block, which will replace <code>&amp;lt;</code> (<code>&amp;gt;</code>) with <code>&lt;</code> (<code>&gt;</code>).</p>
<h1 id="sec-funblock">10 Function Block</h1>
<p>Function block makes things really interesting. Without function block, bsmdoc is almost useless. Function block provides a easy way to allow the content to be processed before sent to the final html file.
As you have seen above, the syntax of a function block looks like</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span>command
content
<span class="nt">!}</span>
</pre></div>
<p>where <code>command</code> is optional and may contain the name and arguments of the corresponding function block.</p>
<p>As described above, many features mentioned above are implemented with function blocks.
For example,</p>
<ul>
<li><p><a href="#sec-image">image</a> block:</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">image</span>||
image-path
<span class="nt">!}</span>
</pre></div></li>
<li><p><a href="#sec-equation">equation</a> block:</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">math</span>||<span class="nt">{%</span>
latex-equation
<span class="nt">%}!}</span>
</pre></div></li>
<li><p><a href="#sec-highlight">syntax highlight</a> block:</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">highlight</span>|<span class="nt">language</span>||<span class="nt">{%</span>
code
<span class="nt">%}!}</span>
</pre></div></li>
<li><p>div tag</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;div-class&quot;</span><span class="p">&gt;</span>
content
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">div</span>|<span class="nt">div-class</span>||
content
<span class="nt">!}</span>
</pre></div>
</div></li>
<li><p>pre tag</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;</span>
content
<span class="p">&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">pre</span>||<span class="nt">{%</span>
content
<span class="nt">%}!}</span>
</pre></div>
</div></li>
<li><p>general tag</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="p">&lt;</span><span class="nt">key</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;tag-class&quot;</span><span class="p">&gt;</span>
content
<span class="p">&lt;/</span><span class="nt">key</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">tag</span>|<span class="nt">key</span>|<span class="nt">tag-class</span>||
content
<span class="nt">!}</span>
</pre></div>
</div></li>
</ul>
<p>The <code>command</code> section is optional. When the <code>command</code> section is not defined, the function block behaves exactly same as the simple block (<code>{}</code>). Otherwise, the corresponding function will be called to process the content.
As you may have already figured out, the <code>command</code> section is defined as</p>
<div class="syntax"><pre><span></span>command|arg0|arg1|arg2|...|argN||
</pre></div>
<p>The command can have arbitrary number of arguments, which are separated by "<code>|</code>". And the command is always terminated by "<code>||</code>". It is also possible to combine multiple commands, e.g.,</p>
<div class="syntax"><pre><span></span>command0|arg0|arg1|arg2||command1|arg0|arg1|arg2||
</pre></div>
<p>In this case, the commands are called from right to left. Thus in the above example, <code>command1</code> will be called first, and its result will be sent to <code>command0</code>. The result from <code>command0</code> will be sent to the html file. It is equivalently to the following nested blocks</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">command0</span>|<span class="nt">arg0</span>|<span class="nt">arg1</span>|<span class="nt">arg2</span>||
<span class="nt">{!</span><span class="nf">command1</span>|<span class="nt">arg0</span>|<span class="nt">arg1</span>|<span class="nt">arg2</span>||
    content
<span class="nt">!}!}</span>
</pre></div>
<p>The function block makes it easy to extend bsmdoc. We could have defined all kinds of function blocks to generate all html tags, and write a comprehensive doc so we can look up later. We don't. Otherwise, that will not be significantly different from remembering all html syntax. Instead, we make it easy to add new functions.</p>
<p>When bsmdoc sees the following function block</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">command</span>|<span class="nt">arg0</span>|<span class="nt">arg1</span>||
    content
<span class="nt">!}</span>
</pre></div>
<p>it will search for the function decorated with "<code>@BFunction('command')</code>". If found, it will execute the command with list "<code>[arg0, arg1]</code>" as argument. For example, if you want to define a function block to achieve the "<del>delete</del>" effect,</p>
<ul>
<li><p>first you need to define the function (e.g., "<code>bsmdoc_del</code>") with decorator "<code>@BFunction('del')</code>"; the function name (<code>bsmdoc_del</code>) is not important.</p>
<div class="syntax"><pre><span></span><span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_del</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;del&gt;</span><span class="si">%s</span><span class="s2">&lt;/del&gt;&quot;</span><span class="o">%</span><span class="n">data</span>
</pre></div>
<p><code>*args</code> will have all the arguments from the function block. For example, if <code>del</code> is called as</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">del</span>|<span class="nt">arg0</span>|<span class="nt">arg1</span>||
    content
<span class="nt">!}</span>
</pre></div>
<p>then bsmdoc will call <code>bsmdoc_del</code> by</p>
<div class="syntax"><pre><span></span><span class="n">bsmdoc_del</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;arg0&quot;</span><span class="p">,</span> <span class="s2">&quot;arg1&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
<p>Here <code>**kwargs</code> are additional arguments from bsmdoc, for example</p>
<table>
<thead>
<tr>
<th>argument</th><th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>inline</td><td><code>True</code> if it is a inline block (we will discuss the inline block shortly).</td>
</tr>
<tr>
<td>filename</td><td>the current filename</td>
</tr>
<tr>
<td>lineno</td><td>the line number of the start of the function block</td>
</tr>
<tr>
<td>fun_args</td><td>the list string arguments from function block</td>
</tr>
<tr>
<td>fun_kwargs</td><td>the dict of keyword arguments from function block</td>
</tr>
</tbody>
</table>
<p>Such info may be helpful to show debugging tips once some error happens.</p>
<p>bsmdoc will also parse the arguments from the function. All string arguments will be in list <b>fun_args</b> (e.g., <b>'args0'</b>) and keyword arguments will be in dict <b>fun_kwargs</b> (e.g., argument <b>key=value</b> will be convert to <b>fun_kwargs[key]=value</b>). In this case, if <b>value</b> is a number, it will be convert to a number, e.g., <b>"answer=42"</b> will be <b>fun_kwargs['answer']=42</b>; otherwise, <b>value</b> will be a string, e.g., <b>"today=sunday"</b> will be <b>fun_kwargs['today']='sunday'</b>.</p>
<p>For a argument to be recognized as keyword argument, first, it has to have an "<code>=</code>" in it; second, the string to the left of the first "<code>=</code>" shall be a valid python identifier.</p></li>
<li><p>Now <code>del</code> (the name from <code>@BFunction</code> decorator) can be used as all the other blocks,</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="p">&lt;</span><span class="nt">del</span><span class="p">&gt;</span>delete<span class="p">&lt;/</span><span class="nt">del</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">del</span>||
delete
<span class="nt">!}</span>
</pre></div>
</div></li>
</ul>
<p>All <code>command</code> functions shall return a <strong>string</strong>, which will be sent to the next block or the html file. If the function does not need to change the html file, it shall return the empty string.</p>
<p>The next question is where to put the function definition? One straightforward solution is to define the above <code>bsmdoc_del</code> function in <b>bsmdoc.py</b> and then all the documents can use the <code>del</code> function block. However, that also means once you need some missing features, you need to go back to the <b>bsmdoc.py</b> and define the functions there. It may cause two potential issues:</p>
<ul>
<li>It needs to edit additional file <b>bsmdoc.py</b> besides the docs you are working on. Thus the change is not local to the doc itself. If there is some mistake in the code, suddenly no doc can be compiled;</li>
<li>How about two docs need slightly different implementation of some function? You may end up either using some slightly different (but not straightforward) function names, or adding additional arguments to the function blocks.</li>
</ul>
<p>Neither way is scalable. bsmdoc provides the third choice: the function block can be defined in the same doc where it is called. To achieve that, bsmdoc define a special <code>exec</code> block</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>||<span class="nt">{%</span>
<span class="n">code</span>
<span class="nt">%}!}</span>
</pre></div>
<p>which will execute the <code>code</code> automatically.
Thus, including the following code in your doc will automatically add the <code>bsmdoc_del</code> function just as it is defined in <b>bsmdoc.py</b> (but be careful, since bsmdoc will call python function "<code>exec()</code>" for this feature, it may cause some security concerns).</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>||<span class="nt">{%</span>
<span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_del</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;del&gt;</span><span class="si">%s</span><span class="s2">&lt;/del&gt;&quot;</span><span class="o">%</span><span class="n">content</span>
<span class="nt">%}!}</span>
</pre></div>
<p>With the <code>exec</code> block, you can replace all the predefined blocks with this method. For example, you can define your code highlight function block so that you can highlight your own language or with other library</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>||<span class="nt">{%</span>
<span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_highlight</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="o">...</span>
<span class="nt">%}!}</span>
</pre></div>
<p>Or in some case, you just want to use your own function for some arguments. For example, you want to call your own function to highlight the code for a specific language, and use the default function for all the others. In this case, you may try</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>||<span class="nt">{%</span>
<span class="n">bsmdoc_highlight_raw</span> <span class="o">=</span> <span class="n">BFunction</span><span class="p">()</span><span class="o">.</span><span class="n">highlight</span> <span class="c1"># get the current highlight function</span>
<span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_highlight</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;mylang&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">bsmdoc_highlight_raw</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># highlight &#39;mylang&#39;</span>
    <span class="o">...</span>
<span class="nt">%}!}</span>
</pre></div>
<p>It may work fine to compile most of your docs, until one day it fails and python complains indefinite loop. The problem here is that the above definition assumes such code will only be called once. But it is not always true for bsmdoc. As mentioned before, bsmdoc may scan the doc multiple times to solve the late-defined references. Thus, when bsmdoc executes the above code second time, <code>bsmdoc_highlight_raw</code> will not refer to the original <code>bsmdoc_highlight</code>, instead, it will also point to the local defined copy. The definition will be equivalent to</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>||<span class="nt">{%</span>
<span class="n">bsmdoc_highlight_raw</span> <span class="o">=</span> <span class="n">BFunction</span><span class="p">()</span><span class="o">.</span><span class="n">highlight</span>
<span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_highlight</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;mylang&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">bsmdoc_highlight</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># highlight &#39;mylang&#39;</span>
    <span class="o">...</span>
<span class="nt">%}!}</span>
</pre></div>
<p>It is apparently an indefinite loop.</p>
<p>Several techniques can be used to solve this problem. For example, you can always define the whole function by yourself, instead of calling the default function in some branches. Or you may check whether the local function has been defined or not</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>||<span class="nt">{%</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">bsmdoc_highlight_raw</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="n">bsmdoc_highlight_raw</span> <span class="o">=</span> <span class="n">BFunction</span><span class="p">()</span><span class="o">.</span><span class="n">highlight</span>
    <span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">bsmdoc_highlight</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;mylang&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bsmdoc_highlight</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># highlight &#39;mylang&#39;</span>
        <span class="o">...</span>
<span class="nt">%}!}</span>
</pre></div>
<p>Or you can tell bsmdoc to execute the code for the first scan only</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>|<span class="nt">firstRunOnly</span>||<span class="nt">{%</span>
<span class="n">bsmdoc_highlight_raw</span> <span class="o">=</span> <span class="n">BFunction</span><span class="p">()</span><span class="o">.</span><span class="n">highlight</span>
<span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_highlight</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lang</span> <span class="o">!=</span> <span class="s1">&#39;mylang&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">bsmdoc_highlight</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># highlight &#39;mylang&#39;</span>
    <span class="o">...</span>
<span class="nt">%}!}</span>
</pre></div>
<h2 id="sec-10-1">10.1 Generate Images</h2>
<p>Besides defining the function block, the <code>exec</code> block can also be used to execute arbitrary python code (<b>be careful!</b>). One application is to embed the python code to generate the figure with <a href="http://matplotlib.org/">matplotlib</a> package,</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>||<span class="nt">{%</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;pie.svg&quot;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="c1"># Compute pie slices</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">radii</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
    <span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">radii</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="c1"># Use custom colors and opacity</span>
    <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">radii</span><span class="p">,</span> <span class="n">bars</span><span class="p">):</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="mf">10.</span><span class="p">))</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;image/pie.svg&quot;</span><span class="p">)</span>
<span class="nt">%}!}</span>
</pre></div>
<p>Then you can include the <b>pie.svg</b> in your html file</p>
<div class="bs-example">
<figure class="figure">
<img src="./image/pie.svg" alt="./image/pie.svg">
</figure>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">image</span>||
./image/pie.svg
<span class="nt">!}</span>
</pre></div>
</div>
<p>Thus, there may be no need to use other software to generate figures.</p>
<h2 id="sec-10-2">10.2 Include Source Code</h2>
<p>With function block, it is easy to include source code in html doc. For example, to import the python source code in your doc, you can define the following function block</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>|<span class="nt">firstRunOnly</span>||<span class="nt">{%</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;codesnippet&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_codesnippet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">d</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="nt">%}!}</span>
</pre></div>
<p>Then you can include the source code (e.g., matplotlib.pyplot.plot) by</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="nd">@_copy_docstring_and_deprecators</span><span class="p">(</span><span class="n">Axes</span><span class="o">.</span><span class="n">plot</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">ArrayLike</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">scalex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">scaley</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line2D</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">scalex</span><span class="o">=</span><span class="n">scalex</span><span class="p">,</span>
        <span class="n">scaley</span><span class="o">=</span><span class="n">scaley</span><span class="p">,</span>
        <span class="o">**</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>|<span class="nt">firstRunOnly</span>||<span class="nt">{%</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="nt">%}!}</span>
<span class="nt">{!</span><span class="nf">highlight</span>|<span class="nt">python</span>||<span class="nf">codesnippet</span>||
plt.plot
<span class="nt">!}</span>
</pre></div>
</div>
<p>It can be easily extended to include arbitrary code. For example, the following block returns the content of a source file. Of course, you can write a function block to just return certain sections (e.g., a function), instead of the whole file.</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>|<span class="nt">firstRunOnly</span>||<span class="nt">{%</span>
<span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;ccodesnippet&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_ccodesnippet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">data</span>
<span class="nt">%}!}</span>
</pre></div>
<p>Then you can include the source code by</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="c1">// Cache selectors</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">lastId</span><span class="p">,</span>
<span class="w">    </span><span class="nx">topMenu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.menu&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">topTitleHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.toptitle&quot;</span><span class="p">).</span><span class="nx">outerHeight</span><span class="p">()</span><span class="o">+</span><span class="mf">15</span><span class="p">,</span>
<span class="w">    </span><span class="nx">topUL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">topMenu</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="c1">// All list items</span>
<span class="w">    </span><span class="nx">menuItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">topMenu</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="c1">// Anchors corresponding to menu items</span>
<span class="w">    </span><span class="nx">scrollItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">menuItems</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">item</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">auto_hide_child_menu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">menuItems</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">15</span><span class="p">;</span>
<span class="c1">// Bind click handler to menu items so we can get a fancy scroll animation</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">auto_hide_child_menu</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">menuItems</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="nx">offsetTop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">href</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;#&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="nx">href</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="o">-</span><span class="mf">15</span><span class="o">+</span><span class="mf">1</span><span class="p">;</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;html, body&#39;</span><span class="p">).</span><span class="nx">stop</span><span class="p">().</span><span class="nx">animate</span><span class="p">({</span>
<span class="w">            </span><span class="nx">scrollTop</span><span class="o">:</span><span class="w"> </span><span class="nx">offsetTop</span>
<span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="mf">300</span><span class="p">);</span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">update_menu</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Get container scroll position</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">fromTop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">15</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Get id of current scroll item</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">scrollItems</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">fromTop</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// Get the id of the current element</span>
<span class="w">    </span><span class="nx">cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cur</span><span class="p">[</span><span class="nx">cur</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mf">1</span><span class="p">];</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cur</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">cur</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">cur</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastId</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">lastId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Set/remove active class</span>
<span class="w">        </span><span class="nx">menuItems</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">menuItems</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[href=&#39;#&quot;</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;&#39;]&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">auto_hide_child_menu</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">topUL</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">){</span>
<span class="w">                </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">menu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">menuItems</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[href=&#39;#&quot;</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;&#39;]&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">menuul</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">menu</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;inline-block&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">menu</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;inline-block&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Bind to scroll</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">scroll</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="w">    </span><span class="nx">update_menu</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">update_menu</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">highlight</span>|<span class="nt">javascript</span>||<span class="nf">ccodesnippet</span>||
js/menu.js
<span class="nt">!}</span>
</pre></div>
</div>
<h2 id="sec-10-3">10.3 Inline Function Block</h2>
<p>The difference between <b>function block</b> and <b>inline function block</b> is similar to the <b>equation block</b> and <b>inline equation block</b>. In other words, the output of the inline block can be embedded in paragraphs. The syntax is similar to the \(\LaTeX\) macro:</p>
<div class="syntax"><pre><span></span><span class="nf">\command</span><span class="nt">{arg0</span>|<span class="nt">arg1</span>|<span class="nt">...</span>|<span class="nt">argN</span>|content<span class="nt">}</span>
</pre></div>
<p>In general, the blocks defined in the above section can also be used as inline block. For example</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>content<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;</span>content<span class="p">&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nf">\tag</span><span class="nt">{code</span>|content<span class="nt">}</span>
<span class="nf">\pre</span><span class="nt">{</span>content<span class="nt">}</span>
</pre></div>
</div>
<p>bsmdoc defines a special inline function block for configuration (<code>\config{}</code>). It adds a configuration item to bsmdoc's global configuration table, and output empty string to the html file. Thus, it will not directly update the html docs, although the other blocks may rely on such configurations to control their behaviors. The syntax is</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{option</span>|value<span class="nt">}</span>}
</pre></div>
<p>We have seen <a href="#sec-heading">heading</a>, <a href="#sec-image">image</a>, and <a href="#sec-table">table</a> blocks use such feature to set the label and caption. We will see more configurations in Sec. <a href="#sec-template">12</a>.</p>
<h2 id="sec-10-4">10.4 Express Function Block</h2>
<p>Besides the way mentioned above, there is a shortcut to define a function block, if it returns a simple string. The syntax to define a function is</p>
<div class="bs-demo">
<div class="syntax"><pre><span></span><span class="nf">\newfun</span><span class="nt">{name</span>|content<span class="nt">}</span>
</pre></div>
</div>
<p>For example</p>
<div class="syntax"><pre><span></span><span class="nf">\newfun</span><span class="nt">{bsmdoc</span>|<span class="nt">\tag{strong</span>|bsmdoc<span class="nt">}</span>}
</pre></div>
<p>Once it is defined, it can be used as</p>
<div class="bs-example">
<strong>bsmdoc</strong>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span>\bsmdoc
</pre></div>
</div>
<p>where <code>\bsmdoc</code> will be replaced with the result of <code>\tag{strong|bsmdoc}</code>, i.e.,</p>
<div class="syntax"><pre><span></span><span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>bsmdoc<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
</pre></div>
<h1 id="sec-11">11 Input Redirection</h1>
<p>When the doc becomes large, you can split your doc into several docs and includes them in the top doc with the "<code>#include</code>" directive. For example, suppose you are writing a book, and have created <b>chappter1.bsmdoc</b>, <b>chapter2.bsmdoc</b>, .... Then, you can include all the chapters in your <b>book.bsmdoc</b></p>
<div class="syntax"><pre><span></span><span class="k">#include</span><span class="nt"> chapter1.bsmdoc</span>
<span class="nt">#include chapter2.bsmdoc</span>
</pre></div>
<p>bsmdoc will replace the line <b>#include chapter1.bsmdoc</b> with the content of the file <b>chappter1.bsmdoc</b>.</p>
<p>The <code>#include</code> is implemented with function <b>bsmdoc_include</b></p>
<div class="syntax"><pre><span></span><span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;include&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_include</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_bsmdoc_readfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_bsmdoc_error</span><span class="p">(</span><span class="s2">&quot;can&#39;t not find </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</pre></div>
<p>Here <code>data</code> will be anything following <code>#include</code>. In the previous example, it will be "<b>chapter1.bsmdoc</b>" or "<b>chapter2.bsmdoc</b>". If the file is opened successfully, by default <b>bsmdoc_include</b> will return the filename and its content.</p>
<p>It is easy to extend the <b>bsmdoc_include</b> function for more advanced applications, for example</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">exec</span>|<span class="nt">firstRunOnly</span>||<span class="nt">{%</span>
<span class="n">bsmdoc_include_raw</span> <span class="o">=</span> <span class="n">BFunction</span><span class="p">()</span><span class="o">.</span><span class="n">include</span>
<span class="nd">@BFunction</span><span class="p">(</span><span class="s1">&#39;include&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bsmdoc_include</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># assume &#39;data&#39; has multiple sections separated by &#39;|&#39;, in the format of</span>
    <span class="c1"># PATTERN | MAX LINE | FILENAME</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># one section, return the default</span>
        <span class="k">return</span> <span class="n">bsmdoc_include_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">re</span>
        <span class="c1"># assume the last parameter is the filename</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">bsmdoc_include_raw</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">:</span>
            <span class="c1"># invalid filename</span>
            <span class="k">return</span> <span class="n">c</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="c1"># search the PATTERN</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">):</span>
               <span class="n">pattern</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># return the content between the first and second instances of PATTERN</span>
                <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="c1"># too many lines, cut it</span>
                    <span class="n">pattern</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pattern</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
        <span class="k">return</span> <span class="n">c</span>
    <span class="k">return</span> <span class="kc">None</span>
<span class="nt">%}!}</span>
</pre></div>
<p>Then the following code will include the content between the first two headings from file <b>myfile.bsmdoc</b>. And the maximum number of lines is limited to 16.</p>
<div class="syntax"><pre><span></span><span class="k">#include</span><span class="nt"> ^(\\s)*=+|16|./myfile.bsmdoc</span>
</pre></div>
<h1 id="sec-template">12 HTML Template</h1>
<p>By default, bsmdoc uses the following template to generate the html file, which defines 4 sections (i.e., <b>html</b>, <b>header</b>, <b>body</b> and <b>footer</b>)</p>
<div class="syntax"><pre><span></span><span class="k">[html]</span>
<span class="na">begin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;!DOCTYPE html&gt;</span>
<span class="w">    </span><span class="na">&lt;html&gt;</span>
<span class="na">end</span><span class="o">=</span><span class="w"> </span><span class="s">&lt;/html&gt;</span>

<span class="k">[header]</span>
<span class="na">begin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;head&gt;</span>
<span class="w">        </span><span class="na">&lt;meta charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;&gt;</span>
<span class="w">        </span><span class="na">&lt;meta name</span><span class="o">=</span><span class="s">&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span>
<span class="na">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;/head&gt;</span>
<span class="na">content</span><span class="w"> </span><span class="o">=</span>
<span class="na">bsmdoc_css</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[&#39;css/bsmdoc.css&#39;]</span>
<span class="na">bsmdoc_js</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[&#39;js/bsmdoc.js&#39;]</span>
<span class="na">menu_css</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[&#39;css/menu.css&#39;]</span>
<span class="na">menu_js</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[&#39;js/menu.js&#39;]</span>
<span class="na">mathjax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;script&gt;</span>
<span class="w">            </span><span class="na">MathJax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">{</span>
<span class="w">                </span><span class="na">loader</span><span class="o">:</span><span class="w"> </span><span class="s">{</span>
<span class="w">                    </span><span class="na">load</span><span class="o">:</span><span class="w"> </span><span class="s">[&#39;[tex]/tagformat&#39;]</span>
<span class="w">                </span><span class="na">},</span>
<span class="w">                </span><span class="na">tex</span><span class="o">:</span><span class="w"> </span><span class="s">{</span>
<span class="w">                    </span><span class="na">packages</span><span class="o">:</span><span class="w"> </span><span class="s">{&#39;[+]&#39;: [&#39;tagformat&#39;]},</span>
<span class="w">                    </span><span class="na">inlineMath</span><span class="o">:</span><span class="w"> </span><span class="s">[[&#39;\\(&#39;, &#39;\\)&#39;]],</span>
<span class="w">                    </span><span class="na">tags</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;all&quot;,</span>
<span class="w">                    </span><span class="na">tagformat</span><span class="o">:</span><span class="w"> </span><span class="s">{</span>
<span class="w">                        </span><span class="na">id</span><span class="o">:</span><span class="w"> </span><span class="s">(id) =&gt; &#39;mjx-eqn-&#39; + id.replace(/\s/g, &#39;_&#39;),</span>
<span class="w">                    </span><span class="na">}</span>
<span class="w">                </span><span class="na">}</span>
<span class="w">            </span><span class="na">};</span>
<span class="w">         </span><span class="na">&lt;/script&gt;</span>
<span class="w">         </span><span class="na">&lt;script src</span><span class="o">=</span><span class="s">&quot; https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js &quot;&gt;&lt;/script&gt;</span>
<span class="na">jquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot; integrity=&quot;sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>

<span class="k">[body]</span>
<span class="na">begin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;body class=&quot;nomathjax&quot;&gt;</span>
<span class="w">        </span><span class="na">&lt;div class</span><span class="o">=</span><span class="s">&quot;layout&quot;&gt;</span>
<span class="na">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;/div&gt;</span>
<span class="w">      </span><span class="na">&lt;/body&gt;</span>
<span class="c1"># default content is</span>
<span class="c1"># %(article_menu)s</span>
<span class="c1"># &lt;div class=&quot;main&quot;&gt;</span>
<span class="c1">#     %(article_title)s</span>
<span class="c1">#     %(article_content)s</span>
<span class="c1"># &lt;/div&gt;</span>
<span class="na">content</span><span class="w"> </span><span class="o">=</span>

<span class="k">[footer]</span>
<span class="na">begin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;div class=&quot;footer&quot;&gt;</span>
<span class="na">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;/div&gt;</span>
<span class="na">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;div class=&quot;footer-text&quot;&gt; Last updated %(UPDATED)s by</span>
<span class="w">          </span><span class="na">&lt;a href</span><span class="o">=</span><span class="s">&quot;http://bsmdoc.feiyilin.com/&quot;&gt;bsmdoc&lt;/a&gt;%(SOURCE)s.&lt;/div&gt;</span>
</pre></div>
<p>Using a separate configuration file seems not to be compatible with our goal to include everything in a single file, although sometimes it may be convenient (for example, to use the same configuration file for multiple docs). bsmdoc also provides a way to include the customized template in your doc, for example</p>
<div class="syntax"><pre><span></span><span class="na">{!config||{%</span>
<span class="k">[html]</span>
<span class="na">begin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot;</span>
<span class="w">    </span><span class="na">&quot;http</span><span class="o">:</span><span class="s">//www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;</span>
<span class="w">    </span><span class="na">&lt;html xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;</span>
<span class="na">end</span><span class="o">=</span><span class="w"> </span><span class="s">&lt;/html&gt;</span>
<span class="na">...</span>
<span class="na">%}!}</span>
</pre></div>
<p>In this case, "<b>config</b>" function block is called without any argument. And its content should have a INI file structure.</p>
<p>bsmdoc uses <a href="https://docs.python.org/2/library/configparser.html">ConfigParser</a> to parse the configurations. Thus, <b>%()s</b> will be resolved to the corresponding configuration values. The configuration name is case insensitive. For example,</p>
<ul>
<li><p><b>%(TITLE)s</b> will be replaced with "<b>my html title</b>", if you config the title with</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{title</span>|my html title<span class="nt">}</span>
</pre></div></li>
<li><b>%(UPDATED)s</b> will be replaced with the time when the html file is generated.</li>
<li><b>%(SOURCE)s</b> will be replaced with the bsmdoc filename.</li>
</ul>
<p>It is easy to create a configuration by</p>
<ul>
<li><p>define the macro content, e.g.,</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{MYMACRO</span>|...<span class="nt">}</span>
</pre></div></li>
<li><p>use the configuration in the template</p>
<div class="syntax"><pre><span></span>...%(MYMACRO}s...
</pre></div></li>
</ul>
<p>bsmdoc defines "<code>css</code>" configuration to insert additional <code>css</code> in the html file without change the html template</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{css</span>|my.css<span class="nt">}</span>
</pre></div>
<p>To insert multiple css files, separate them with white-space</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{css</span>|my.css my2.css<span class="nt">}</span>
</pre></div>
<p>or</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{css</span>|my.css<span class="nt">}</span>
<span class="nf">\config</span><span class="nt">{css</span>|<span class="nt">add</span>|my2.css<span class="nt">}</span>
</pre></div>
<p>where <code>add</code> option tells bsmdoc to append the configuration to the current one.</p>
<p>Similarly, bsmdoc also defines the "<code>js</code>" configuration to include javascripts in the html file</p>
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{js</span>|myjs.js myjs2.js<span class="nt">}</span>
</pre></div>
<p>There are two ways to define doc title. The first one is to use the <code>toptitle</code> configuration. For example, the following line will define the top title</p>
<div class="bs-example">
<div class="syntax"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;toptitle&quot;</span><span class="p">&gt;</span>
    bsmdoc -- another technical html doc generator
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;subtitle&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;mailto:tq@feiyilin.com&#39;</span><span class="p">&gt;</span>tq@feiyilin.com<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="bs-example-src">
<div class="syntax"><pre><span></span><span class="nf">\config</span><span class="nt">{doctitle</span>|bsmdoc -- another technical html doc generator<span class="nt">}</span>
<span class="nf">\config</span><span class="nt">{subtitle</span>|<span class="nt">[mailto:tq@feiyilin.com</span>|tq@feiyilin.com]<span class="nt">}</span>
</pre></div>
</div>
<p>It is easy to see that it is equivalent to the following code</p>
<div class="syntax"><pre><span></span><span class="nt">{!</span><span class="nf">div</span>|<span class="nt">toptitle</span>||
bsmdoc -- another technical html doc generator
<span class="nt">{!</span><span class="nf">div</span>|<span class="nt">subtitle</span>||
<span class="nt">[mailto:tq@feiyilin.com</span>|tq@feiyilin.com]
<span class="nt">!}</span>
<span class="nt">!}</span>
</pre></div>
</div>
</div>
<div class="reference">
<ol>
<li><div id="reference-1">
Simon Haykin, "Adaptive Filter Theory," Prentice Hall, 4th edition, Sep. 2001 <a href="#cite-1-1">&#8617;</a>
</div></li>
</ol>
</div>

<div class="footer">
<div class="footnote">
<ol>
<li><div id="footnote-1">
This is a footnote <a href="#footnote_src-1">&#8617;</a>
</div></li>
</ol>
</div>

<div class="footer-text"> Last updated 2023-12-27 22:00:57 UTC, by <a href="http://bsmdoc.feiyilin.com/">bsmdoc</a>  | <a href="mailto:tq@feiyilin.com">Contact</a></div>
</div>
</div>
</body>
</html>